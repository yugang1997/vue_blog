(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-46488c97"],{"0944":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Message"},[n("Nav"),n("div",{staticClass:"main"},[n("div",{staticClass:"content"},[n("article",[n("section",[n("h1",[t._v("留言板")]),n("p",[t._v("沟通交流，拉近你我！")]),n("RichText",{on:{Sub:t.handleSubmit}})],1),n("section",[n("ul",t._l(t.commentList,(function(e,i){return n("li",{key:e._id},[n("div",{staticClass:"comment-parent"},[n("div",{staticClass:"p-img",style:{backgroundImage:"url("+e.user.photo+")"}}),n("div",{staticClass:"p-info"},[n("div",{staticClass:"p-name"},[t._v(t._s(e.user.user))]),n("div",{staticClass:"p-content",domProps:{innerHTML:t._s(e.content)}}),n("div",{staticClass:"p-time"},[n("span",[t._v(t._s(t._f("getTime")(e.date)))]),n("a",{on:{click:function(e){return t.replyClick(i)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===i&&void 0===e.reply.lastIndexArr[1]?"收起":"回复")+" ")])])])]),t._l(e.children,(function(r,a){return n("div",{key:r.date+Math.random(),staticClass:"comment-child"},[n("div",{staticClass:"c-img",style:{backgroundImage:"url("+r.user.photo+")"}}),n("div",{staticClass:"c-info"},[n("div",{staticClass:"c-name"},[n("span",{staticClass:"name"},[t._v(t._s(r.user.user))]),t._v("回复"),n("span",{staticClass:"name"},[t._v(t._s(r.reUser))]),n("span",{staticClass:"c-content",domProps:{innerHTML:t._s(r.content)}})]),n("div",{staticClass:"c-time"},[n("span",[t._v(t._s(t._f("getTime")(r.date)))]),n("a",{on:{click:function(e){return t.replyClick(i,a)}}},[t._v(" "+t._s(e.reply.lastIndexArr[0]===i&&e.reply.lastIndexArr[1]===a?"收起":"回复")+" ")])])])])})),n("div",{class:["comment-reply",{show:e.reply.ifShow}]},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reply.content,expression:"item.reply.content"}],attrs:{placeholder:"回复【"+e.reply.reUser+"】"},domProps:{value:e.reply.content},on:{input:function(n){n.target.composing||t.$set(e.reply,"content",n.target.value)}}}),n("button",{staticClass:"layui-btn layui-btn-xs",attrs:{type:"button"},on:{click:function(e){return t.childCommit(i)}}},[t._v("提交")])])],2)})),0)])])])])],1)},r=[],a=(n("99af"),n("4160"),n("159b"),n("216c")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("textarea",{staticStyle:{display:"none"},attrs:{id:"demo"}}),n("button",{staticClass:"layui-btn",attrs:{type:"button"},on:{click:t.handleClick}},[t._v("提交留言")])])},c=[],s={name:"RichText",data:function(){return{layedit:null,index:0}},methods:{handleClick:function(){this.$emit("Sub",this.layedit.getContent(this.index))}},mounted:function(){var t=this;layui.use("layedit",(function(){t.layedit=layui.layedit,t.index=t.layedit.build("demo",{tool:["face"]})}))}},l=s,u=n("2877"),d=Object(u["a"])(l,o,c,!1,null,"1bd8831f",null),f=d.exports,m=n("365c"),h=m["a"].getIfLogin,p=m["a"].commitMessage,v=m["a"].getMessageList,y=m["a"].commitChildMessage;function g(t){return(t<10?"0":"")+t}var b={name:"Message",components:{Nav:a["a"],RichText:f},data:function(){return{commentList:[],skip:0,limit:0,ifLoading:!1}},filters:{getTime:function(t){var e=new Date(t),n=g(e.getFullYear()),i=g(e.getMonth()+1),r=g(e.getDay()),a=g(e.getHours()),o=g(e.getMinutes()),c=g(e.getSeconds());return"".concat(n,"年").concat(i,"月").concat(r,"日").concat(a,":").concat(o,":").concat(c)}},methods:{handleSubmit:function(t){h().then((function(e){e.data.userInfo?p({user:e.data.userInfo._id,content:t}).then((function(t){0===t.data.code?(layer.msg("留言成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3)):(layer.msg(t.data.msg,{icon:2}),setTimeout((function(){window.location.reload()}),1e3))})).catch((function(){layer.msg("服务器错误，请稍后再试~~",{icon:2})})):layer.msg("请先登录",{icon:2})})).catch((function(){layer.msg("服务器错误，请稍后再试~~",{icon:2})}))},replyClick:function(t,e){if(void 0!==t){var n=this.commentList[t];this.commentList[t].reply.reUser=void 0!==e?this.commentList[t].children[e].user.user:this.commentList[t].user.user,t===n.reply.lastIndexArr[0]&&e===n.reply.lastIndexArr[1]?(n.reply.ifShow=!1,n.reply.lastIndexArr=[]):(n.reply.ifShow=!0,n.reply.lastIndexArr=[t,e])}},childCommit:function(t){var e=this;h().then((function(n){n.data.userInfo?y({parentId:e.commentList[t]._id,user:n.data.userInfo._id,content:e.commentList[t].reply.content,reUser:e.commentList[t].reply.reUser}).then((function(t){t.data.code?layer.msg(t.data.msg,{icon:2}):(layer.msg("评论成功",{icon:1}),setTimeout((function(){window.location.reload()}),1e3))})):layer.msg("请先登录",{icon:2})})).catch((function(){layer.msg("服务器错误，请稍后再试~~",{icon:2})}))},handleScroll:function(){var t=this;if(!this.ifLoading){var e=document.documentElement.offsetHeight,n=document.documentElement.clientHeight,i=document.documentElement.scrollTop;i+n>=e-200&&(this.ifLoading=!0,this.getMessageListFresh((function(e){t.ifLoading=!1})))}},getMessageListFresh:function(t){var e=this;this.limit+=5,v(this.skip,this.limit).then((function(n){if(0===n.data.code){var i=n.data.data;i.forEach((function(t){t.reply={user:"",content:"",reUser:"",date:"",ifShow:!1,lastIndexArr:[]}})),e.commentList=i}t&&t()})).catch((function(){t&&t()}))}},created:function(){this.getMessageListFresh()},mounted:function(){window.addEventListener("scroll",this.handleScroll)},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)}},_=b,x=(n("6881"),Object(u["a"])(_,i,r,!1,null,"5caac311",null));e["default"]=x.exports},"159b":function(t,e,n){var i=n("da84"),r=n("fdbc"),a=n("17c2"),o=n("9112");for(var c in r){var s=i[c],l=s&&s.prototype;if(l&&l.forEach!==a)try{o(l,"forEach",a)}catch(u){l.forEach=a}}},"17c2":function(t,e,n){"use strict";var i=n("b727").forEach,r=n("a640"),a=n("ae40"),o=r("forEach"),c=a("forEach");t.exports=o&&c?[].forEach:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}},"1dde":function(t,e,n){var i=n("d039"),r=n("b622"),a=n("2d00"),o=r("species");t.exports=function(t){return a>=51||!i((function(){var e=[],n=e.constructor={};return n[o]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},4160:function(t,e,n){"use strict";var i=n("23e7"),r=n("17c2");i({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},"65f0":function(t,e,n){var i=n("861d"),r=n("e8b5"),a=n("b622"),o=a("species");t.exports=function(t,e){var n;return r(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!r(n.prototype)?i(n)&&(n=n[o],null===n&&(n=void 0)):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}},6881:function(t,e,n){"use strict";var i=n("e679"),r=n.n(i);r.a},"99af":function(t,e,n){"use strict";var i=n("23e7"),r=n("d039"),a=n("e8b5"),o=n("861d"),c=n("7b0b"),s=n("50c4"),l=n("8418"),u=n("65f0"),d=n("1dde"),f=n("b622"),m=n("2d00"),h=f("isConcatSpreadable"),p=9007199254740991,v="Maximum allowed index exceeded",y=m>=51||!r((function(){var t=[];return t[h]=!1,t.concat()[0]!==t})),g=d("concat"),b=function(t){if(!o(t))return!1;var e=t[h];return void 0!==e?!!e:a(t)},_=!y||!g;i({target:"Array",proto:!0,forced:_},{concat:function(t){var e,n,i,r,a,o=c(this),d=u(o,0),f=0;for(e=-1,i=arguments.length;e<i;e++)if(a=-1===e?o:arguments[e],b(a)){if(r=s(a.length),f+r>p)throw TypeError(v);for(n=0;n<r;n++,f++)n in a&&l(d,f,a[n])}else{if(f>=p)throw TypeError(v);l(d,f++,a)}return d.length=f,d}})},b727:function(t,e,n){var i=n("0366"),r=n("44ad"),a=n("7b0b"),o=n("50c4"),c=n("65f0"),s=[].push,l=function(t){var e=1==t,n=2==t,l=3==t,u=4==t,d=6==t,f=5==t||d;return function(m,h,p,v){for(var y,g,b=a(m),_=r(b),x=i(h,p,3),C=o(_.length),w=0,L=v||c,E=e?L(m,C):n?L(m,0):void 0;C>w;w++)if((f||w in _)&&(y=_[w],g=x(y,w,b),t))if(e)E[w]=g;else if(g)switch(t){case 3:return!0;case 5:return y;case 6:return w;case 2:s.call(E,y)}else if(u)return!1;return d?-1:l||u?u:E}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6)}},e679:function(t,e,n){},e8b5:function(t,e,n){var i=n("c6b6");t.exports=Array.isArray||function(t){return"Array"==i(t)}}}]);
//# sourceMappingURL=chunk-46488c97.93964ab0.js.map